<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Zuul Hands on - part 3 - Use the Zuul jobs library - Software Factory</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="./zuul-hands-on-part-3-use-the-zuul-jobs-library.html">

        <meta name="author" content="Fabien Boucher" />
        <meta name="keywords" content="zuul-hands-on-series" />
        <meta name="description" content="In this article, we will: provision a python project with a test suite based on tox explain how to use the zuul-jobs library in order to benefit from jobs maintained by the Zuul community. This article is part of the Zuul hands-on series. Note that most of the links reference …" />

        <meta property="og:site_name" content="Software Factory" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Zuul Hands on - part 3 - Use the Zuul jobs library"/>
        <meta property="og:url" content="./zuul-hands-on-part-3-use-the-zuul-jobs-library.html"/>
        <meta property="og:description" content="In this article, we will: provision a python project with a test suite based on tox explain how to use the zuul-jobs library in order to benefit from jobs maintained by the Zuul community. This article is part of the Zuul hands-on series. Note that most of the links reference …"/>
        <meta property="article:published_time" content="2018-09-20" />
            <meta property="article:section" content="blog" />
            <meta property="article:tag" content="zuul-hands-on-series" />
            <meta property="article:author" content="Fabien Boucher" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css"/>
    <link href="./theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="./theme/css/pygments/solarizedlight.css" rel="stylesheet">
        <link href="./theme/css/html4css1.css" rel="stylesheet">
    <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>


        <link href="./blog.xml" type="application/atom+xml" rel="alternate"
              title="Software Factory blog ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="./" class="navbar-brand">
<img class="img-responsive pull-left gap-right" src="./images/SoftwareFactory-logo.svg" width="20px"/> Software Factory            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="./pages/contact.html">
                             Contact
                          </a></li>
                        <li class="active">
                            <a href="./category/blog.html">Blog</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="./zuul-hands-on-part-3-use-the-zuul-jobs-library.html"
                       rel="bookmark"
                       title="Permalink to Zuul Hands on - part 3 - Use the Zuul jobs library">
                        Zuul Hands on - part 3 - Use the Zuul jobs library
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-09-20T00:00:00+00:00"> Thu 20 September 2018</time>
    </span>


            <span class="label label-default">By</span>
            <a href="./author/fabien-boucher.html"><i class="fa fa-user"></i> Fabien Boucher</a>



<span class="label label-default">Tags</span>
	<a href="./tag/zuul-hands-on-series.html">zuul-hands-on-series</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>In this article, we will:</p>
<ul class="simple">
<li>provision a python project with a test suite based on tox</li>
<li>explain how to use the <a class="reference external" href="https://github.com/openstack-infra/zuul-jobs">zuul-jobs library</a> in
order to benefit from jobs maintained by the Zuul community.</li>
</ul>
<p>This article is part of the <a class="reference external" href="./tag/zuul-hands-on-series.html">Zuul hands-on series</a>.</p>
<p>Note that most of the links reference <em>sftests.com</em> which is the default domain of the sandbox
documented in the <em>How to setup a Software Factory sandbox</em> blog post. Make sure to adapt the
links if necessary.</p>
<p>The examples and commands are intended to be run on a Software Factory
sandbox where a <strong>demo-repo</strong> repository exists. You should have such an environment
after following the previous articles in this series:</p>
<ul class="simple">
<li>To deploy a Software Factory sandbox please read the <a class="reference external" href="./how-to-setup-a-software-factory-sandbox.html">first article of the series</a>.</li>
<li>To create the <strong>demo-repo</strong> repository, please follow the sections <a class="reference external" href="./zuul-hands-on-part-2-your-first-gated-patch-with-zuul.html#clone-the-config-repository">Clone the config repository</a>
and <a class="reference external" href="./zuul-hands-on-part-2-your-first-gated-patch-with-zuul.html#define-the-demo-repo-repository">Define the demo-repo repository</a> sections.</li>
</ul>
<p>If you have already deployed a Software Factory sandbox and created a snapshot as
suggested, you can restore this snapshot to follow this article on a clean environment.
In that case make sure the system date of your virtual machine is correct post
restoration. If not fix it by running</p>
<div class="highlight"><pre><span></span>systemctl stop ntpd<span class="p">;</span> ntpd -gq<span class="p">;</span> systemctl start ntpd
</pre></div>
<div class="section" id="the-zuul-jobs-library">
<h2>The Zuul Jobs Library</h2>
<p>By design Zuul promotes reusability in its approach to jobs. In that spirit, a
public jobs library is available at <a class="reference external" href="https://git.zuul-ci.org">git.zuul-ci.org</a>.</p>
<p>The library contains jobs that can be used directly as is, and more elementary
roles that can be included into your own playbooks.</p>
<p>As of now the <strong>zuul-jobs</strong> library covers mainly typical CI or
CD needs for Python and Javascript projects, for example:</p>
<ul class="simple">
<li>publishing a package to PyPI</li>
<li>tox tests</li>
<li>npm commands</li>
<li>documentation building with Sphinx</li>
</ul>
<p>Zuul however can support CI and CD for any language, and the library is a good
source of examples to start from when writing your own jobs. And if your jobs
are generic enough, do not hesitate to
<a class="reference external" href="http://git.zuul-ci.org/cgit/zuul-jobs/">contribute upstream</a> to enrich the library.</p>
</div>
<div class="section" id="provision-the-demo-repo-source-code">
<h2>Provision the demo-repo source code</h2>
<p>Clone <strong>demo-repo</strong> and provision it with <a class="reference external" href="./demo-codes/hoz-4-demo-repo.tgz">this demo code</a> .</p>
<div class="highlight"><pre><span></span>git clone -c http.sslVerify<span class="o">=</span><span class="nb">false</span> https://sftests.com/r/demo-repo
<span class="nb">cd</span> demo-repo
git review -s <span class="c1"># Enter admin as username</span>
tar -xzf /tmp/hoz-4-demo-repo.tgz -C .
</pre></div>
<p>This will add a <strong>tox ini file</strong> to the repository, so unittests can be started
by running tox (obviously, make sure you have tox installed on your system first).</p>
<div class="highlight"><pre><span></span>tox
</pre></div>
<p>If you went through the third article of the series to the end, remove also
the previous jobs and pipelines definitions, and the now useless hello.py file:</p>
<div class="highlight"><pre><span></span>git rm -r playbooks .zuul.yaml hello.py
</pre></div>
<p>Push the code to the <strong>demo-repo</strong> repository. Note that we don't use <strong>git review</strong>
here to bypass the review process of Gerrit. We will reconfigure the CI later.</p>
<div class="highlight"><pre><span></span>git add -A
git commit -m<span class="s2">&quot;Initialize demo-repo project&quot;</span>
git push gerrit
</pre></div>
</div>
<div class="section" id="use-zuul-jobs-tox-jobs">
<h2>Use zuul-jobs tox jobs</h2>
<p>Software Factory bundles a copy of the upstream zuul-jobs library. You can
browse zuul-jobs's <a class="reference external" href="https://sftests.com/r/gitweb?p=zuul-jobs.git;a=tree">source code (sftests.com)</a> and
its <a class="reference external" href="https://sftests.com/docs/zuul-jobs/">documentation (sftests.com)</a>.</p>
<p>As the <strong>demo-repo</strong> source code comes with a tox file we can benefit from
the <strong>tox-py27</strong> and <strong>tox-pep8</strong> jobs defined in <strong>zuul-jobs</strong>.</p>
<p>In <strong>demo-repo</strong>, create the file <strong>.zuul.yaml</strong>:</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">project</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">check</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">jobs</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tox-py27</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tox-pep8</span><span class="w"></span>
<span class="w">    </span><span class="nt">gate</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">jobs</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tox-py27</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tox-pep8</span><span class="w"></span>
</pre></div>
<p>Then submit the change on Gerrit:</p>
<div class="highlight"><pre><span></span>git add .zuul.yaml
git commit -m<span class="s2">&quot;Init demo-repo pipelines&quot;</span>
git review
</pre></div>
<p>Both jobs will be started in parallel by Zuul, as can be seen in the
<a class="reference external" href="https://sftests.com/zuul/t/local/status">status (sftests.com)</a> page.</p>
<img alt="None" src="images/zuul-hands-on-part4-c1.png" />
<p>When the jobs are completed, the produced artifacts will be stored on the log
server as usual. Along with the expected console log, inventory file and ARA report,
you will also find the logs of the execution stages of tox in the <strong>tox</strong>
directory.</p>
<p>This concludes this article on how to use the zuul jobs library with your projects.</p>
<p>To use the upstream version of the Zuul jobs library instead of
the one embedded in Software Factory, you can do so by following the steps described in this
<a class="reference external" href="https://sftests.com/docs/operator/zuul_operator.html#use-openstack-infra-zuul-jobs">configuration section (sftests.com)</a>.</p>
<p>Stay tuned for the next article.</p>
</div>

            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="./sprint-2024-aug-09-to-2024-aug-28-summary.html">Sprint 2024 Aug 09 to 2024 Aug 28 summary</a></li>
    <li class="list-group-item"><a href="./sprint-2024-jul-19-to-2024-aug-07-summary.html">Sprint 2024 Jul 19 to 2024 Aug 07 summary</a></li>
    <li class="list-group-item"><a href="./sprint-2024-jun-28-to-2024-jul-17-summary.html">Sprint 2024 Jun 28 to 2024 Jul 17 summary</a></li>
    <li class="list-group-item"><a href="./sprint-2024-jun-07-to-2024-jun-26-summary.html">Sprint 2024 Jun 07 to 2024 Jun 26 summary</a></li>
    <li class="list-group-item"><a href="./sprint-2024-may-16-to-2024-jun-05-summary.html">Sprint 2024 May 16 to 2024 Jun 05 summary</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2024 Red Hat
           &middot; Powered by <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>
           &middot; This work is licensed under a
               <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
                 Creative Commons Attribution 4.0 International License
               </a>.
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="./theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="./theme/js/respond.min.js"></script>




</body>
</html>