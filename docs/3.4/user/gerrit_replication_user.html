

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configure Gerrit git repositories replication &mdash; software-factory  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="software-factory  documentation" href="../index.html"/>
        <link rel="up" title="The Config repository" href="config_repo.html"/>
        <link rel="next" title="Gerrit comments link customisation" href="gerritlinks_user.html"/>
        <link rel="prev" title="Gerritbot notification channels configuration" href="gerritbot_user.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> software-factory
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create_and_configure.html">Create and configure a new project</a></li>
<li class="toctree-l2"><a class="reference internal" href="contribute.html">Contribute to a project on SF</a></li>
<li class="toctree-l2"><a class="reference internal" href="review_workflow.html">Review workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="short_git.html">Short Git introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="short_gerrit.html">Gerrit short user documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="log_classify.html">Log Classify User</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="config_repo.html">The Config repository</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="resources_user.html">Managing resources via the config repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="zuul_user.html">Zuul user documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="nodepool_user.html">Nodepool user documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="gerritbot_user.html">Gerritbot notification channels configuration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Configure Gerrit git repositories replication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-the-replication-for-a-repository">Configure the replication for a repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-the-replication-ssh-public-key">Get the replication SSH public key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-repository-replication-on-github">Configuring repository replication on Github</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="gerritlinks_user.html">Gerrit comments link customisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_control_user.html">API access control</a></li>
<li class="toctree-l3"><a class="reference internal" href="repoxplorer_user.html">RepoXplorer</a></li>
<li class="toctree-l3"><a class="reference internal" href="pages_user.html">Publish static web content</a></li>
<li class="toctree-l3"><a class="reference internal" href="firehose_user.html">Firehose</a></li>
<li class="toctree-l3"><a class="reference internal" href="metrics.html">System and services metrics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operator/index.html">Operator documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributor/index.html">Contributor documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs/index.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">software-factory</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">User documentation</a> &raquo;</li>
        
          <li><a href="config_repo.html">The Config repository</a> &raquo;</li>
        
      <li>Configure Gerrit git repositories replication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user/gerrit_replication_user.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configure-gerrit-git-repositories-replication">
<span id="gerrit-replication-user"></span><h1>Configure Gerrit git repositories replication<a class="headerlink" href="#configure-gerrit-git-repositories-replication" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Software Factory can replicate git repositories to remote git servers.
This feature relies on Gerrit’s replication plugin.</p>
<p>The replication settings can be changed in the config repository; they can be found in the directory
“gerrit” you will find a file called replication.config.</p>
<p>The replication of repositories should be done using the SSH protocol.
By default Software Factory will use its own SSH private key to
authenticate against the remote server.</p>
</div>
<div class="section" id="configure-the-replication-for-a-repository">
<h2>Configure the replication for a repository<a class="headerlink" href="#configure-the-replication-for-a-repository" title="Permalink to this headline">¶</a></h2>
<p>As a project’s maintainer, I want to setup the replication of my repositories
<em>myproject-client</em> and <em>myproject-server</em> to a remote server. So I have to submit
a patch to the config repository.</p>
<p>Clone the config repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://&lt;fqdn&gt;/r/config
</pre></div>
</div>
<p>Edit the file <em>gerrit/replication.config</em> and add the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[remote &quot;example-mirror&quot;]
    url = sf@mirrors.domain.example:/home/mirror/git/${name}.git
    mirror = true
    projects = ^myproject-.*
</pre></div>
</div>
<p>Here we configure the replication to replicate repositories
where names match the regular expression “^myproject-.*” to the remote
server mirrors.domain.example. The special placeholder “${name}” is needed here
because the regular expression will match several repositories. The “mirror” option is
set to <em>true</em> to replicate branch deletion.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Software Factory’s replication support is based on Gerrit’s own replication plugin.
More information on available options can be found in the
<a class="reference external" href="https://softwarefactory-project.io/r/plugins/replication/Documentation/config.html">Replication README</a>.</p>
</div>
<p>Then commit and send the patch for review.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git commit -m<span class="s1">&#39;Add replication for myproject suite&#39;</span>
$ git review
</pre></div>
</div>
<p>Once the patch is merged the <em>config-update</em> job will trigger the replication
to mirrors.domain.example (in that example).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The public key used for the replication needs to be added to
the <em>.ssh/authorized_keys</em> of the sf user on mirrors.domain.example.</p>
</div>
<p>See the <a class="reference internal" href="../operator/gerrit_replication_operator.html#gerrit-replication-operator"><span class="std std-ref">Gerrit replication operator documentation</span></a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If mirrors.domain.example has never been used as a replication
target, then the Software Factory administrator should add the server’s
host key to the known_hosts file on Software Factory’s Gerrit node.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is no need to create the bare git repository on the
remote server as long as a regular shell is available on the target. The
replication plugin will create the repository if it does not exist.</p>
</div>
</div>
<div class="section" id="get-the-replication-ssh-public-key">
<h2>Get the replication SSH public key<a class="headerlink" href="#get-the-replication-ssh-public-key" title="Permalink to this headline">¶</a></h2>
<p>Gerrit SSH public key is available at the following URL.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl -OL https://&lt;fqdn&gt;/keys/gerrit_service_rsa.pub
</pre></div>
</div>
</div>
<div class="section" id="configuring-repository-replication-on-github">
<h2>Configuring repository replication on Github<a class="headerlink" href="#configuring-repository-replication-on-github" title="Permalink to this headline">¶</a></h2>
<p>There are two solutions you may use to replicate on Github:</p>
<blockquote>
<div><ul class="simple">
<li>Define a deployment key in your github repository’s settings</li>
<li>Add a collaborator to your github repository’s settings</li>
</ul>
</div></blockquote>
<p>The former is less straigtforward than the latter, and involve more work from the
Software Factory administrator, because the replication plugin will by default use its
own key to authenticate against Github. However each deployment key on GitHub
must be unique so you will have to create a key pair and request your
Software Factory administrator to add the private key on Software Factory.</p>
<p>The latter does not require any specific configuration from
the Software Factory administrator. As a Github project owner you should add a
collaborator, and register the Software Factory public key in the “SSH key” section of the
Github user settings. Software Factory will then act on behalf of that Github user for
the replication. Please ask your Software Factory administrator if a specific user
on Github already exists for replication purposes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Software Factory won’t create repositories on Github if they do not exist. They
must be created manually.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gerritlinks_user.html" class="btn btn-neutral float-right" title="Gerrit comments link customisation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gerritbot_user.html" class="btn btn-neutral" title="Gerritbot notification channels configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Red Hat.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>